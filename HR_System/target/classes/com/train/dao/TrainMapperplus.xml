<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.train.dao.TrainPlusMapper">

    <resultMap id="plusmap" type="com.train.pojo.TrainPlus">
        <id column="t_pid" property="tPid"/>
        <result column="s_id" property="sId"/>
        <result column="t_name" property="tName"/>
        <result column="t_teacher" property="tTeacher"/>
        <result column="t_member" property="tMember"/>
        <result column="t_goal" property="tGoal"/>
        <result column="t_introduction" property="tIntroduction"/>
        <result column="t_start" property="tStart"/>
        <result column="t_end" property="tEnd"/>
        <association property="resp" javaType="com.train.pojo.Response">
			<id column="pid" property="pid"/>
            <result column="response" property="response"/>
        </association>
    </resultMap>

    <!--展示所有培训计划-->
    <select id="showAll" resultMap="plusmap">
    SELECT
	t.t_pid,
	t.s_id,
	t.t_name,
	t.t_teacher,
	t.t_member,
	t.t_goal,
	t.t_introduction,
	t.t_start,
	t.t_end,
	r.response,
	r.pid,
	count(*) sum
FROM
	t_train t
LEFT JOIN t_response r ON t.t_pid = r.pid
GROUP BY
	t.t_pid
    ORDER BY t.t_pid ASC
  </select>

    <!--按照名称查询培训计划-->
    <select id="selectByName" parameterType="String" resultMap="plusmap">
    SELECT
	t.t_pid,
	t.s_id,
	t.t_name,
	t.t_teacher,
	t.t_member,
	t.t_goal,
	t.t_introduction,
	t.t_start,
	t.t_end,
	r.response,
	r.pid,
	count(*) sum
FROM
	t_train t
LEFT JOIN t_response r ON t.t_pid = r.pid
WHERE
	t_name LIKE "%" #{tName,jdbcType=VARCHAR} "%"
GROUP BY
	t_pid
    ORDER BY t_pid DESC
  </select>

    <!--按照审核状态查询培训计划-->
    <select id="selectByStatus" parameterType="Integer" resultMap="plusmap">
    SELECT
	t.t_pid,
	t.s_id,
	t.t_name,
	t.t_teacher,
	t.t_member,
	t.t_goal,
	t.t_introduction,
	t.t_start,
	t.t_end,
	r.response,
	r.pid,
	count(*) sum
FROM
	t_train t
LEFT JOIN t_response r ON t.t_pid = r.pid
WHERE
	t.s_id = #{sId}
GROUP BY
	t.t_pid
    ORDER BY t.t_pid DESC
  </select>

    <!--按照培训开始时间查询培训计划-->
    <select id="selectByStartTime" parameterType="String" resultMap="plusmap">
   SELECT
	t.t_pid,
	t.s_id,
	t.t_name,
	t.t_teacher,
	t.t_member,
	t.t_goal,
	t.t_introduction,
	t.t_start,
	t.t_end,
	r.response,
	r.pid,
	count(*) sum
FROM
	t_train t
LEFT JOIN t_response r ON t.t_pid = r.pid
WHERE
	t.t_start like "%"#{tStart}"%"
GROUP BY
	t_pid
    ORDER BY t_pid DESC
  </select>

    <!--按照培训结束时间查询培训计划-->
    <select id="selectByEndTime" parameterType="String" resultMap="plusmap">
    SELECT
	t.t_pid,
	t.s_id,
	t.t_name,
	t.t_teacher,
	t.t_member,
	t.t_goal,
	t.t_introduction,
	t.t_start,
	t.t_end,
	r.response,
	r.pid,
	count(*) sum
FROM
	t_train t
LEFT JOIN t_response r ON t.t_pid = r.pid
WHERE
	t.t_end like "%"#{tEnd}"%"
GROUP BY
	t_pid
    ORDER BY t_pid DESC
  </select>

</mapper>